%info
RecordTimestamp ecosystem

Test the RecordTimestamp ecosystem (TimestampDiff, NumberPacket, ...)

%script
click -j 1 CONFIG

%file IN1
!data ts_sec len payload
1 60 A
2 60 B
3 60 C
4 60 D
5 60 E
10 60 F
15 60 1
20 60 2
25 60 3
30 60 4

%file CONFIG
FromIPSummaryDump(IN1, STOP false)
-> SetTimestamp
-> MarkMACHeader
-> NumberPacket
-> record:: RecordTimestamp()
-> Queue
-> DelayUnqueue(1)
-> counter :: AverageCounter()
-> CheckNumberPacket(OFFSET 40, COUNT 10)
-> diff :: TimestampDiff(RECORDER record)
-> Counter(COUNT_CALL 5 double.run)
-> Counter(COUNT_CALL 10 finished.run)
-> Discard;

double :: Script(TYPE PASSIVE, write du.delay 5)
finished :: Script(TYPE PASSIVE, read diff.average, read diff.average 0, read diff.average 5, read counter.count, stop)

%expect stderr
diff.average:
{{[0-9]{1,3}[.][0-9]+}}
diff.average:
{{[0-9]{1,3}[.][0-9]+}}
diff.average:
{{[0-9]{1,3}[.][0-9]+}}
counter.count:
10
